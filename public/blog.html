<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Building an AI Chat System | Sudharsana Palaniappan</title>
  <meta name="description" content="A deep dive into building a production AI chat system with practical memory, search, and multimodal intelligence.">
  <meta name="author" content="Sudharsana Palaniappan">

  <!-- Open Graph -->
  <meta property="og:title" content="Building an AI Chat System with Practical Memory, Search, and Multimodal Intelligence">
  <meta property="og:description" content="A behind-the-scenes engineering deep dive into building production AI systems.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://chat.sudharsana.dev/blog">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-tertiary: #1a1a24;
      --bg-card: #16161f;
      --text-primary: #f4f4f5;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      --accent-blue: #3b82f6;
      --accent-purple: #8b5cf6;
      --accent-cyan: #06b6d4;
      --accent-green: #10b981;
      --accent-orange: #f97316;
      --border-color: #27272a;
      --gradient-start: #3b82f6;
      --gradient-end: #8b5cf6;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.7;
      font-size: 17px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Reading Progress Bar */
    .progress-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 0%;
      height: 3px;
      background: linear-gradient(90deg, var(--gradient-start), var(--gradient-end));
      z-index: 1000;
      transition: width 0.1s ease-out;
    }

    /* Navigation */
    .nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      padding: 1rem 2rem;
      background: rgba(10, 10, 15, 0.8);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-color);
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav-brand {
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--text-primary);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .nav-brand::before {
      content: '';
      width: 8px;
      height: 8px;
      background: var(--accent-green);
      border-radius: 50%;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }

    .nav-link {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.9rem;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      transition: all 0.2s ease;
    }

    .nav-link:hover {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }

    /* Hero Section */
    .hero {
      padding: 10rem 2rem 6rem;
      max-width: 900px;
      margin: 0 auto;
      position: relative;
    }

    .hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      height: 500px;
      background: radial-gradient(ellipse at center top, rgba(59, 130, 246, 0.15) 0%, transparent 70%);
      pointer-events: none;
    }

    .hero-meta {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 2rem;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .hero-tag {
      padding: 0.35rem 0.85rem;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(139, 92, 246, 0.15));
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 20px;
      font-size: 0.8rem;
      color: var(--accent-blue);
      font-weight: 500;
    }

    .hero h1 {
      font-size: clamp(2.5rem, 5vw, 3.5rem);
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 1.5rem;
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero-subtitle {
      font-size: 1.25rem;
      color: var(--text-secondary);
      max-width: 650px;
      line-height: 1.8;
    }

    /* Table of Contents */
    .toc {
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
      right: 2rem;
      max-width: 250px;
      padding: 1.5rem;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      z-index: 50;
      opacity: 0;
      animation: fadeIn 0.5s ease 1s forwards;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    @media (max-width: 1400px) {
      .toc { display: none; }
    }

    .toc-title {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      margin-bottom: 1rem;
      font-weight: 600;
    }

    .toc-list {
      list-style: none;
    }

    .toc-item {
      margin-bottom: 0.5rem;
    }

    .toc-link {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.85rem;
      display: block;
      padding: 0.35rem 0;
      border-left: 2px solid transparent;
      padding-left: 0.75rem;
      transition: all 0.2s ease;
    }

    .toc-link:hover,
    .toc-link.active {
      color: var(--accent-blue);
      border-left-color: var(--accent-blue);
    }

    /* Main Content */
    .content {
      max-width: 750px;
      margin: 0 auto;
      padding: 0 2rem 6rem;
    }

    .content h2 {
      font-size: 1.75rem;
      font-weight: 600;
      margin: 4rem 0 1.5rem;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .content h2::before {
      content: '';
      width: 4px;
      height: 1.5rem;
      background: linear-gradient(180deg, var(--accent-blue), var(--accent-purple));
      border-radius: 2px;
    }

    .content h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin: 2.5rem 0 1rem;
      color: var(--text-primary);
    }

    .content p {
      margin-bottom: 1.5rem;
      color: var(--text-secondary);
    }

    .content strong {
      color: var(--text-primary);
      font-weight: 600;
    }

    /* Feature Cards */
    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }

    .feature-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 1.5rem;
      transition: all 0.3s ease;
    }

    .feature-card:hover {
      border-color: var(--accent-blue);
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(59, 130, 246, 0.1);
    }

    .feature-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
      font-size: 1.25rem;
    }

    .feature-card h4 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }

    .feature-card p {
      font-size: 0.9rem;
      margin: 0;
      color: var(--text-muted);
    }

    /* Highlight Box */
    .highlight-box {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(139, 92, 246, 0.08));
      border: 1px solid rgba(59, 130, 246, 0.2);
      border-radius: 12px;
      padding: 1.5rem 2rem;
      margin: 2rem 0;
    }

    .highlight-box p {
      margin: 0;
      font-style: italic;
      color: var(--text-secondary);
    }

    /* Code Blocks */
    .code-block {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      margin: 1.5rem 0;
      overflow: hidden;
    }

    .code-header {
      background: var(--bg-tertiary);
      padding: 0.75rem 1rem;
      font-size: 0.8rem;
      color: var(--text-muted);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .code-header::before {
      content: '';
      width: 12px;
      height: 12px;
      background: var(--accent-green);
      border-radius: 50%;
      opacity: 0.8;
    }

    .code-content {
      padding: 1.25rem;
      overflow-x: auto;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9rem;
      line-height: 1.6;
      color: var(--text-secondary);
    }

    .code-content .keyword { color: var(--accent-purple); }
    .code-content .string { color: var(--accent-green); }
    .code-content .comment { color: var(--text-muted); }
    .code-content .function { color: var(--accent-blue); }

    /* Architecture Diagram */
    .architecture {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 2rem;
      margin: 2rem 0;
    }

    .architecture-title {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .architecture-flow {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .arch-node {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 0.75rem 1.25rem;
      font-size: 0.85rem;
      color: var(--text-secondary);
      text-align: center;
      min-width: 120px;
    }

    .arch-node.primary {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(139, 92, 246, 0.15));
      border-color: rgba(59, 130, 246, 0.3);
      color: var(--text-primary);
    }

    .arch-arrow {
      color: var(--text-muted);
      font-size: 1.25rem;
    }

    /* Principles List */
    .principles {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin: 2rem 0;
    }

    .principle {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      padding: 1.25rem;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      transition: all 0.2s ease;
    }

    .principle:hover {
      border-color: var(--accent-cyan);
    }

    .principle-number {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue));
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.9rem;
      flex-shrink: 0;
    }

    .principle-text {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }

    /* Divider */
    .divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--border-color), transparent);
      margin: 4rem 0;
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 4rem 2rem;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-color);
    }

    .footer-cta {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .footer-text {
      color: var(--text-muted);
      margin-bottom: 2rem;
    }

    .footer-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .footer-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .hero { padding: 8rem 1.5rem 4rem; }
      .content { padding: 0 1.5rem 4rem; }
      .content h2 { font-size: 1.5rem; }
      .architecture-flow { flex-direction: column; }
      .arch-arrow { transform: rotate(90deg); }
    }

    /* Animations */
    .fade-up {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeUp 0.6s ease forwards;
    }

    @keyframes fadeUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .delay-1 { animation-delay: 0.1s; }
    .delay-2 { animation-delay: 0.2s; }
    .delay-3 { animation-delay: 0.3s; }
  </style>
</head>
<body>
  <!-- Progress Bar -->
  <div class="progress-bar" id="progress"></div>

  <!-- Navigation -->
  <nav class="nav">
    <a href="/" class="nav-brand">chat.sudharsana.dev</a>
    <a href="/chat" class="nav-link">Try the Chat &rarr;</a>
  </nav>

  <!-- Table of Contents -->
  <aside class="toc">
    <div class="toc-title">On this page</div>
    <ul class="toc-list">
      <li class="toc-item"><a href="#philosophy" class="toc-link">Core Philosophy</a></li>
      <li class="toc-item"><a href="#memory" class="toc-link">Smart Summarization</a></li>
      <li class="toc-item"><a href="#rendering" class="toc-link">Markdown Rendering</a></li>
      <li class="toc-item"><a href="#search" class="toc-link">Web Search</a></li>
      <li class="toc-item"><a href="#vision" class="toc-link">Vision Support</a></li>
      <li class="toc-item"><a href="#data" class="toc-link">Data Layer</a></li>
      <li class="toc-item"><a href="#architecture" class="toc-link">Why This Architecture</a></li>
    </ul>
  </aside>

  <!-- Hero -->
  <header class="hero">
    <div class="hero-meta fade-up">
      <span class="hero-tag">Engineering Deep Dive</span>
      <span>15 min read</span>
    </div>
    <h1 class="fade-up delay-1">Building an AI Chat System with Practical Memory, Search, and Multimodal Intelligence</h1>
    <p class="hero-subtitle fade-up delay-2">Modern AI chat systems look simple on the surface. A text box, a response, maybe some formatting. Under the hood, a reliable production system is a careful orchestration of memory management, retrieval, rendering, and infrastructure decisions.</p>
  </header>

  <!-- Content -->
  <main class="content">
    <p class="fade-up delay-3">This post walks through how this chat platform was designed and why certain architectural choices were made. The goal was not just to make a chatbot that works, but to make one that <strong>scales</strong>, <strong>feels natural</strong>, and remains <strong>cost efficient</strong> while handling long-running conversations.</p>

    <section id="philosophy">
      <h2>The Core Philosophy</h2>
      <p>The system is built around three principles:</p>

      <div class="principles">
        <div class="principle">
          <div class="principle-number">1</div>
          <div class="principle-text"><strong>Conversations should feel continuous and context-aware.</strong> Users shouldn't have to repeat themselves or feel like they're starting over.</div>
        </div>
        <div class="principle">
          <div class="principle-number">2</div>
          <div class="principle-text"><strong>Token usage must stay predictable and efficient.</strong> Costs scale linearly with usage, not exponentially with conversation length.</div>
        </div>
        <div class="principle">
          <div class="principle-number">3</div>
          <div class="principle-text"><strong>Features should degrade gracefully.</strong> When something fails, the system continues working rather than crashing.</div>
        </div>
      </div>

      <div class="highlight-box">
        <p>This leads to a design where memory is curated, not hoarded, and where context is treated as a dynamic resource rather than an ever-growing log.</p>
      </div>
    </section>

    <section id="memory">
      <h2>Smart Summarization and Practical Memory</h2>
      <p>One of the hardest problems in LLM applications is memory. Sending the entire chat history on every request quickly becomes expensive and slow. The solution is not infinite context windows, but <strong>intelligent compression</strong>.</p>

      <p>Long conversations are periodically summarized in the background. When a thread crosses a threshold, a background worker generates a structured summary that captures intent, key facts, and unresolved topics. This summary is stored in a <code>conversation_summaries</code> table and becomes the canonical memory of earlier dialogue.</p>

      <div class="architecture">
        <div class="architecture-title">Context Composition Flow</div>
        <div class="architecture-flow">
          <div class="arch-node">Recent Messages</div>
          <span class="arch-arrow">+</span>
          <div class="arch-node">Summary Snapshot</div>
          <span class="arch-arrow">+</span>
          <div class="arch-node">System Instructions</div>
          <span class="arch-arrow">&rarr;</span>
          <div class="arch-node primary">Final Context</div>
        </div>
      </div>

      <p>This reduces token usage dramatically while preserving continuity. Instead of pretending to have infinite memory, the system maintains <strong>useful</strong> memory.</p>

      <p>From an implementation perspective, this requires asynchronous jobs, idempotent summarization logic, and careful versioning so that summaries can be regenerated if prompts evolve.</p>
    </section>

    <section id="rendering">
      <h2>Markdown Rendering for Human-Friendly Output</h2>
      <p>Raw LLM text often looks messy in real products. Formatting matters for trust and readability.</p>

      <p>Responses are rendered using markdown with support for code blocks, emphasis, and structured text. The renderer is strict about sanitization to avoid injection issues while still allowing rich formatting.</p>

      <div class="code-block">
        <div class="code-header">Response Pipeline</div>
        <div class="code-content">
<span class="comment">// Model output</span>
<span class="keyword">const</span> raw = <span class="string">"Here's the code:\n```js\nconsole.log('hello')\n```"</span>;

<span class="comment">// Sanitize & render</span>
<span class="keyword">const</span> safe = <span class="function">sanitize</span>(raw);
<span class="keyword">const</span> html = <span class="function">marked.parse</span>(safe);

<span class="comment">// Display with proper styling</span>
container.<span class="function">innerHTML</span> = html;
        </div>
      </div>

      <p>The model is prompted to prefer structured markdown when appropriate. The frontend then renders this into clean UI components. This creates a clear separation between generation and presentation.</p>
    </section>

    <div class="divider"></div>

    <section id="search">
      <h2>Web Search Integration</h2>
      <p>Web search is used as an augmentation layer for freshness. It is triggered <strong>selectively</strong> when queries require current or factual data.</p>

      <p>The architecture treats search as a tool call, not a default. The model first reasons about whether it needs external information. If yes, the system retrieves results, filters them, and injects only relevant snippets into context.</p>

      <div class="feature-grid">
        <div class="feature-card">
          <div class="feature-icon">üéØ</div>
          <h4>Selective Triggering</h4>
          <p>Search runs only when the query signals need for current information.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">‚ö°</div>
          <h4>Filtered Results</h4>
          <p>Only relevant snippets are injected to keep latency and costs low.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">üîÑ</div>
          <h4>Graceful Fallback</h4>
          <p>If search fails, the model responds with its training knowledge.</p>
        </div>
      </div>

      <p>This keeps latency and cost under control while improving reliability for time-sensitive queries.</p>
    </section>

    <section id="vision">
      <h2>Vision Support and Multimodal Input</h2>
      <p>Image upload enables visual reasoning. Images are processed and passed to multimodal models along with textual instructions.</p>

      <p>The important design choice here is <strong>graceful fallback</strong>. If vision processing fails or is unavailable, the system informs the user rather than hallucinating.</p>

      <div class="highlight-box">
        <p>Multimodal features are powerful, but they must be wrapped in strong guardrails to maintain trust.</p>
      </div>
    </section>

    <section id="data">
      <h2>Data Layer and Reliability</h2>
      <p>At the storage layer, conversations, summaries, and metadata are separated. Raw messages are <strong>append-only</strong>. Summaries are <strong>versioned</strong>. This allows reprocessing and experimentation without corrupting history.</p>

      <div class="code-block">
        <div class="code-header">Data Model</div>
        <div class="code-content">
<span class="keyword">TABLE</span> messages
  id, session_id, role, content, created_at

<span class="keyword">TABLE</span> conversation_summaries
  id, session_id, summary_type, message_range_start,
  message_range_end, summary_text, token_count, created_at

<span class="keyword">TABLE</span> sessions
  id, user_id, title, created_at, updated_at
        </div>
      </div>

      <p>Background jobs handle summarization and cleanup. Retries and timeouts are built in. The system assumes that external APIs can fail and designs around it.</p>
    </section>

    <div class="divider"></div>

    <section id="architecture">
      <h2>Why This Architecture</h2>
      <p>Every major decision ties back to scalability, cost control, and user experience:</p>

      <div class="feature-grid">
        <div class="feature-card">
          <div class="feature-icon">üìä</div>
          <h4>Summarization</h4>
          <p>Controls token growth for long conversations.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">üé®</div>
          <h4>Structured Rendering</h4>
          <p>Improves clarity and perceived quality.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">üîß</div>
          <h4>Tool-Based Augmentation</h4>
          <p>Enables capabilities without bloating every request.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">üèóÔ∏è</div>
          <h4>Separation of Concerns</h4>
          <p>The data model enables iteration and evolution.</p>
        </div>
      </div>

      <p>The system is designed to evolve. Prompts can change. Models can be swapped. Summaries can be regenerated. The architecture supports this flexibility.</p>

      <h3>What This Enables Next</h3>
      <p>With these foundations, it becomes easier to add personalization, long-term memory layers, or domain-specific tools. The system is not a demo‚Äîit's a <strong>platform for continuous improvement</strong>.</p>

      <div class="highlight-box">
        <p>Building AI products is less about a single model and more about the system around it. Memory, retrieval, formatting, and orchestration are where product quality is won or lost.</p>
      </div>

      <p>If you're building in this space, focus on lifecycle and architecture as much as on model quality. That's where real differentiation emerges.</p>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-cta">Experience it yourself</div>
    <p class="footer-text">See these principles in action with a live demo.</p>
    <a href="/chat" class="footer-link">
      <span>Try the Chat</span>
      <span>&rarr;</span>
    </a>
  </footer>

  <script>
    // Progress bar
    window.addEventListener('scroll', () => {
      const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrolled = (winScroll / height) * 100;
      document.getElementById('progress').style.width = scrolled + '%';
    });

    // Active TOC link
    const sections = document.querySelectorAll('section[id]');
    const tocLinks = document.querySelectorAll('.toc-link');

    window.addEventListener('scroll', () => {
      let current = '';
      sections.forEach(section => {
        const sectionTop = section.offsetTop;
        const sectionHeight = section.clientHeight;
        if (scrollY >= sectionTop - 200) {
          current = section.getAttribute('id');
        }
      });

      tocLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === '#' + current) {
          link.classList.add('active');
        }
      });
    });
  </script>
</body>
</html>
